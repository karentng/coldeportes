{% extends 'base.html' %}
{% load bootstrap3 %}

{% block miga_pan %}
	<li><a href="{% url 'inicio' %}">Inicio</a></li>
	<li><a href="{%  url 'listar_eventos' %}">Eventos</a>
	<li><a href="{%  url 'registrar_actividad' actividad.evento_perteneciente%}">Actividades</a>
	<li class="active">Resultados</li>
{% endblock %}

{% block botones_panel %}
    <a href="{% url 'registrar_actividad' actividad.evento_perteneciente %}" class="btn btn-warning btn-xs "><i class="fa fa-arrow-left"></i> Regresar</a>
{% endblock %}

{% block css %}
    {{ form.media }}
    <link href="{{STATIC_URL}}plugins/DataTables/css/data-table.css" rel="stylesheet" />
{% endblock %}

{% block titulo_panel %}
	Resultados
{% endblock %}

{% block contenido_panel %}
    <div class="row">
    {% if "gestion_eventos.change_evento" in perms %}
        <div class="col-md-4" >
            <h3>Actividad: {{ actividad.titulo }}</h3>
            <form id="form-resultado" action="" method="post">{% csrf_token %}
                <div class="well row">
                    <div class="col-xs-12">
                        {% if edicion %}
                            <h3>Modificar resultado</h3>
                        {% else %}
                            <h3>Registrar resultado</h3>
                        {% endif %}
                        {% for field in form %}
                            {% if "lugar" in field.name %}
                                {% bootstrap_field field layout="vertical" form_group_class="form-group animated" %}
                            {% else %}
                                {% bootstrap_field field layout="vertical" %}
                            {% endif %}
                        {% endfor %}
                        {% if edicion %}
                            <button class="pull-right row btn btn-primary m-l-15" type="submit" style="margin-top:10px;margin-right: 1px;"><i class="fa fa-check"></i> Guardar</button>
                            <a href="{% url 'registrar_resultado' actividad.id %}" class="pull-right row btn btn-warning" type="button" style="margin-top:10px"><i class="fa fa-ban"></i> Cancelar</a>
                        {% else %}
                            <button class="pull-right row btn btn-primary" type="submit" style="margin-top:10px;margin-right: 1px;"><i class="fa fa-plus"></i> Añadir</button>
                        {% endif %}
                    </div>
                </div>
            </form>
        </div>
    {% endif %}
        <div class="{% if "gestion_eventos.change_evento" in perms %}col-md-8{% else %}col-md-12{% endif %}">
            <h3>Resultados Registrados Actualmente:</h3>

            {% if lista_resultados %}
                <div class="table-responsive">
                    <table id="tabla-resultados" class="table table-bordered table-hover toggle-circle" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>Titulo</th>
                                <th>Cantidad premiación</th>
                                <th>Participantes</th>
                                <th>Estado</th>
                                {% if "gestion_eventos.change_evento" in perms %}
                                    <th>Opciones</th>
                                {% endif %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for resultado in lista_resultados %}
                                <tr>
                                    <td>{% if resultado.titulo %}{{ resultado.titulo }}{% else %}{{ actividad.titulo }}{% endif %}</td>
                                    <td>{{resultado.get_cantidad_puestos_display}}</td>
                                    <td>
                                        Primer Lugar: {{resultado.primer_lugar}}<br>
                                        {% if resultado.segundo_lugar %}
                                            Segundo Lugar: {{resultado.segundo_lugar}}<br>
                                        {% endif %}
                                        {% if resultado.tercer_lugar %}
                                            Segundo Lugar: {{resultado.tercer_lugar}}<br>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if resultado.estado == 1 %}
                                            Activo
                                        {% else %}
                                            Inactivo
                                        {% endif %}
                                    </td>
                                {% if "gestion_eventos.change_evento" in perms %}
                                    <td>
                                        <a href="{% url 'editar_resultado' resultado.id %}"><i class="fa fa-edit"> Editar </i></a><br>
                                    </td>
                                {% endif %}
                                </tr>

                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-warning fade in m-b-15"><strong>No hay resultados registrados</strong></div>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block js %}
    <script type="text/javascript">
        idTabla = "tabla-resultados";
    </script>
    <script src="{{STATIC_URL}}js/coldeportes/tabla_extendida.js"></script>

    <script src="{{ STATIC_URL }}js/validaciones/gestion_eventos/validaciones-resultados.js"></script>

    <script src="{{STATIC_URL}}plugins/DataTables/js/jquery.dataTables.js"></script>
    <script src="{{STATIC_URL}}plugins/DataTables/js/dataTables.tableTools.js"></script>
{% endblock %}