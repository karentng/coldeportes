{% extends 'dirigentes/wizard/wizard_identificacion.html' %}
{% load bootstrap3 %}
{% load i18n %}

{% block js %}
    <script src="{{STATIC_URL}}js/validaciones/dirigentes/wizard_funciones-validations.js"></script>
    <script type="text/javascript">
        var modal = "<div class='modal fade' id='modal-desactivate{funcion_id}'> <div class='modal-dialog'> <div class='modal-content'> <div class='modal-header'> <button type='button' class='close' data-dismiss='modal' aria-hidden='true'>×</button> <h4 class='modal-title'>Eliminar Función:</h4> </div> <div class='modal-body'> ¿Está seguro que desea eliminar esta función? </div> <div class='modal-footer'> <a href='javascript:;' class='btn btn-sm btn-white' data-dismiss='modal'>Cancelar</a> <a href='/dirigentes/eliminar/funcion/{dirigente_id}/{cargo_id}/{funcion_id}' class='btn btn-sm btn-warning'>Aceptar</a> </div> </div> </div> </div>"
        var link_modal = "<a href='#modal-desactivate{funcion_id}' data-toggle='modal'><i class='fa fa-trash'></i></a>"
        $('#id_cargo').change(function(){
            var id_cargo = $(this).val();
            var id_dirigente = $('#id_dirigente').val();

            $.ajax({
                url : '/dirigentes/funciones',
                type: 'GET',
                dataType: 'json',
                data: {'id_cargo': id_cargo, 'id_dirigente': id_dirigente},
                success: function(data){
                    var funciones = data['funciones'];
                    var tabla = clear_funciones();

                    for(var i=0;i<funciones.length;i++){
                        var funcion = funciones[i];
                        var lm = link_modal.replace('{funcion_id}',funcion.id);
                        var m = modal.replace(/{funcion.id}/g,funcion.id).replace('{dirigente_id}',id_dirigente).replace('{cargo_id}',id_cargo);
                        var fila = "<tr><td align='center'>"+funcion.descripcion+"</td>";
                        fila += "<td align='center'>" + lm + m + "</td></tr>";
                        tabla.append(fila);
                    }
                },
                error: function(){
                    clear_funciones();
                }
            });

            function clear_funciones(){
                var tabla = $('table tbody');
                tabla.empty();
                return tabla;
            }
        });
    </script>
{% endblock %}

{% block contenido_panel %}
    {% include 'dirigentes/wizard/_wizard.html' %}
        <div class="row">
            <fieldset class="col-md-7" >
                <form id="form-wizard-funciones" action="" method="post">{% csrf_token %}
                <div class="well row">
                    <div class="col-xs-12">
                        <legend class="pull-left width-full">
                            {% include 'dirigentes/wizard/_mensajes.html' %}
                        </legend>
                        {% bootstrap_form form layout='vertical' %}

                        <button class="pull-right row btn btn-info" type="submit" style="margin-top:10px;"><i class="fa fa-save"></i> Guardar</button>              
                    </div>
                </div>
                </form>
            </fieldset> 
            <div class="col-md-5">
                <h4>Funciones Actuales:</h4>
                <table class="table table-responsive">
                    <thead>
                        <tr>
                            <th align="center">Descripción de la función</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
        <br/>
        <ul class="pager bwizard-buttons">
            <a href="{% url 'dirigentes_wizard_cargos' dirigente_id %}" class="btn btn-primary pull-left">{% trans '← Anterior' %}</a>
            <a href="{% url 'dirigentes_finalizar' opcion='listar' %}" class="btn btn-primary pull-right"><i class="fa fa-save"></i>{% trans ' Finalizar' %}</a>
            <a href="{% url 'dirigentes_finalizar' opcion='nuevo' %}" class="btn btn-warning pull-right" style="margin-right: 20px;"><i class="fa fa-circle-o-notch"></i>{% trans ' Finalizar y Guardar Nuevo →' %}</a>
        </ul>

{% endblock %}